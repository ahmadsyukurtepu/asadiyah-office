<div class="animate-fade-in space-y-6">
Â  Â  <div class="bg-white rounded-[40px] p-8 shadow-sm border border-gray-100">
Â  Â  Â  Â  <div class="flex flex-col md:flex-row justify-between items-center gap-6">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-black text-gray-800 tracking-tight uppercase">Data Statistik Santri</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 font-bold text-[10px] uppercase tracking-[0.2em] mt-1">Laporan Real-time As'adiyah</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="sortKategori" onchange="muatDataSantri()" class="bg-gray-50 border-2 border-gray-100 px-4 py-3 rounded-2xl text-[11px] font-black outline-none focus:border-green-600 transition-all cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PUSAT">ğŸ¢ PUSAT</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="CABANG">ğŸŒ¿ CABANG</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="sortTahun" onchange="muatDataSantri()" class="bg-gray-50 border-2 border-gray-100 px-4 py-3 rounded-2xl text-[11px] font-black outline-none focus:border-green-600 transition-all cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">SEMUA TAHUN</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="2026/2027">2026/2027</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="2025/2026">2025/2026</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="muatDataSantri()" id="btnRefresh" class="bg-green-800 text-white p-4 rounded-2xl hover:bg-green-700 active:scale-95 transition-all shadow-lg shadow-green-900/20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-sync-alt" id="iconRefresh"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="bg-white rounded-[40px] shadow-sm border border-gray-100 overflow-hidden relative min-h-[300px]">
Â  Â  Â  Â  <div id="loadingOverlay" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex items-center justify-center flex-col">
Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-circle-notch fa-spin text-4xl text-green-700"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="text-[10px] font-black text-gray-400 uppercase mt-4 tracking-widest">Mengambil Data Cloud...</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="overflow-x-auto">
Â  Â  Â  Â  Â  Â  <table class="w-full text-left border-collapse">
Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="bg-gray-50 text-[10px] font-black text-gray-400 uppercase tracking-widest">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-8 py-6">Tahun Ajaran</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-6">Tingkatan/Lembaga</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-6 text-center">L</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-6 text-center">P</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-8 py-6 text-center">Total</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="tabelSantriBody" class="text-[11px] font-bold text-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="5" class="py-20 text-center text-gray-300 italic">Silakan klik refresh untuk memuat data</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  <tfoot id="tabelSantriFooter" class="bg-gray-50/80 hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="text-[11px] font-black text-gray-800 border-t-2 border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="2" class="px-8 py-6 text-right uppercase tracking-wider">Total Rekapitulasi:</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td id="totalL" class="px-6 py-6 text-center text-blue-600 text-sm">0</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td id="totalP" class="px-6 py-6 text-center text-pink-600 text-sm">0</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td id="totalSemua" class="px-8 py-6 text-center text-green-800 font-black text-sm bg-green-50">0</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  </tfoot>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>
<script>
    async function muatDataSantri() {
        const overlay = document.getElementById('loadingOverlay');
        const icon = document.getElementById('iconRefresh');
        const kat = document.getElementById('sortKategori').value;
        const thnFilter = document.getElementById('sortTahun').value;
        const footer = document.getElementById('tabelSantriFooter');
        const tabelBody = document.getElementById('tabelSantriBody');
        
        // Ambil ID dari CONFIG
        const targetID = (kat === 'PUSAT') ? CONFIG.DB.SANTRI_PUSAT : CONFIG.DB.SANTRI_CABANG;

        overlay.classList.remove('hidden');
        icon.classList.add('fa-spin');
        footer.classList.add('hidden'); 

        try {
            const response = await fetch(`${CONFIG.SCRIPT_URL}?action=bacaSantri&targetID=${targetID}`);
            if (!response.ok) throw new Error('Network response was not ok');
            
            const data = await response.json();

            let html = '';
            let tL = 0, tP = 0, tTotal = 0;

            // PERBAIKAN: Menggunakan row['TAHUN'] (Huruf Kapital) sesuai data JSON
            const filteredData = data.filter(row => thnFilter === 'all' || row['TAHUN'] === thnFilter);

            if (filteredData.length > 0) {
                filteredData.forEach(row => {
                    // PERBAIKAN: Nama properti harus kapital sesuai kiriman Server
                    const valL = parseInt(row['LAKI-LAKI']) || 0;
                    const valP = parseInt(row['PEREMPUAN']) || 0;
                    const totalRow = parseInt(row['TOTAL']) || (valL + valP);
                    
                    // Fleksibel mengambil 'TINGKATAN' atau 'NAMA PENGURUS CABANG'
                    const namaLembaga = row['TINGKATAN'] || row['NAMA PENGURUS CABANG'] || "-";
                    
                    tL += valL;
                    tP += valP;
                    tTotal += totalRow;

                    html += `
                        <tr class="border-b border-gray-50 hover:bg-green-50/30 transition-colors duration-200">
                            <td class="px-8 py-5 text-gray-400 font-medium">${row['TAHUN']}</td>
                            <td class="px-6 py-5">
                                <span class="flex items-center gap-3">
                                    <span class="w-2.5 h-2.5 rounded-full shadow-sm ${kat === 'PUSAT' ? 'bg-blue-500' : 'bg-green-500'}"></span>
                                    <span class="text-gray-700">${namaLembaga}</span>
                                </span>
                            </td>
                            <td class="px-6 py-5 text-center font-mono">${valL.toLocaleString()}</td>
                            <td class="px-6 py-5 text-center font-mono">${valP.toLocaleString()}</td>
                            <td class="px-8 py-5 text-center">
                                <span class="bg-gray-100 px-4 py-1.5 rounded-full text-gray-800 font-black text-[10px]">${totalRow.toLocaleString()}</span>
                            </td>
                        </tr>
                    `;
                });

                tabelBody.innerHTML = html;
                
                // Update Footer
                document.getElementById('totalL').innerText = tL.toLocaleString();
                document.getElementById('totalP').innerText = tP.toLocaleString();
                document.getElementById('totalSemua').innerText = tTotal.toLocaleString() + " SANTRI";
                footer.classList.remove('hidden');
            } else {
                tabelBody.innerHTML = '<tr><td colspan="5" class="py-20 text-center text-gray-400 uppercase tracking-widest text-[10px] font-black">Data Tidak Ditemukan</td></tr>';
            }

        } catch (e) {
            console.error("Fetch Error:", e);
            tabelBody.innerHTML = '<tr><td colspan="5" class="py-20 text-center text-red-400 italic">Gagal memuat data dari server.</td></tr>';
        } finally {
            overlay.classList.add('hidden');
            icon.classList.remove('fa-spin');
        }
    }

    // Gunakan DOMContentLoaded agar script berjalan setelah HTML siap
    document.addEventListener('DOMContentLoaded', muatDataSantri);
</script>
