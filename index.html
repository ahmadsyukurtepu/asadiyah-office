const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyjUbCunq2XkoilsNLBUHmLJV89UpEacemw7OoS8fRQB7oFg0YZ8RS3okOEqADdXmE0/exec'; // Ganti dengan URL hasil Deploy

async function handleAuth(e) {
    e.preventDefault();
    const role = document.getElementById('loginRole').value;
    const id = document.getElementById('loginID').value;
    const pin = document.getElementById('loginPIN').value;
    const btn = document.getElementById('btnLogin');

    btn.innerHTML = "VERIFIKASI...";

    // Mengirim data ke Google menggunakan FETCH
    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: "login",
                id: id,
                pin: pin,
                role: role
            })
        });
        const res = await response.json();

        if (res.status === "OK") {
            userRole = role;
            document.getElementById('loginOverlay').style.display = 'none';
            // Tampilkan dashboard atau form operator
            if (role === 'OFFICER') {
                document.getElementById('sidebar').classList.remove('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('adminName').innerText = "OFFICER: " + res.nama;
            } else {
                tampilkanFormOperator(role, res.nama);
            }
        } else {
            alert("Akses Ditolak! ID atau PIN salah.");
            btn.innerHTML = "Verifikasi Akses";
        }
    } catch (err) {
        alert("Gagal terhubung ke server: " + err);
        btn.innerHTML = "Verifikasi Akses";
    }
}
