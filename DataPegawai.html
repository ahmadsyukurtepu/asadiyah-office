<div class="animate-fade-in space-y-6">
    <div class="bg-white rounded-[40px] p-8 shadow-sm border border-gray-100">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h2 class="text-2xl font-black text-gray-800 tracking-tight uppercase">Database Pegawai / SDM</h2>
                <p class="text-gray-400 font-bold text-[10px] uppercase tracking-[0.2em] mt-1">Status Keaktifan Personel As'adiyah</p>
            </div>
            
            <button onclick="muatDataPegawai()" id="btnRefreshPegawai" class="flex items-center gap-3 bg-blue-600 text-white px-6 py-3 rounded-2xl font-black text-[11px] uppercase tracking-widest hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">
                <i class="fas fa-sync-alt" id="iconPegawai"></i> Sinkronkan Data
            </button>
        </div>
    </div>

    <div class="bg-white rounded-[40px] shadow-sm border border-gray-100 overflow-hidden relative min-h-[400px]">
        <div id="loadingPegawai" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex items-center justify-center flex-col">
            <div class="w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Menghubungkan ke Database...</p>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-blue-50/50 text-[10px] font-black text-blue-400 uppercase tracking-[0.2em]">
                        <th class="px-10 py-7">Status Kepegawaian</th>
                        <th class="px-6 py-7 text-center">L (Pria)</th>
                        <th class="px-6 py-7 text-center">P (Wanita)</th>
                        <th class="px-10 py-7 text-center bg-blue-50/80 text-blue-700">Sub Total</th>
                    </tr>
                </thead>
                <tbody id="tabelPegawaiBody" class="text-[11px] font-bold text-gray-600">
                    </tbody>
                <tfoot id="tabelPegawaiFooter" class="hidden">
                    <tr class="bg-[#1e293b] text-white">
                        <td class="px-10 py-6 text-right uppercase tracking-[0.2em] text-[10px] font-black">Total Personel Keseluruhan</td>
                        <td id="totalPegawaiL" class="px-6 py-6 text-center text-blue-300 text-sm">0</td>
                        <td id="totalPegawaiP" class="px-6 py-6 text-center text-pink-300 text-sm">0</td>
                        <td id="totalPegawaiSemua" class="px-10 py-6 text-center text-yellow-400 font-black text-base italic">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

<script>
    async function muatDataPegawai() {
        const overlay = document.getElementById('loadingPegawai');
        const icon = document.getElementById('iconPegawai');
        const tbody = document.getElementById('tabelPegawaiBody');
        const tfoot = document.getElementById('tabelPegawaiFooter');

        overlay.classList.remove('hidden');
        icon.classList.add('fa-spin');

        try {
            // Mengambil data dari Google Apps Script menggunakan ID Pegawai di Config
            const response = await fetch(`${CONFIG.SCRIPT_URL}?action=bacaPegawai&targetID=${CONFIG.DB.PEGAWAI}`);
            const data = await response.json();

            let html = '';
            let tL = 0, tP = 0;

            data.forEach(row => {
                const subTotal = parseInt(row.l) + parseInt(row.p);
                tL += parseInt(row.l);
                tP += parseInt(row.p);

                html += `
                    <tr class="border-b border-gray-50 hover:bg-blue-50/20 transition-all cursor-default group">
                        <td class="px-10 py-5">
                            <div class="flex items-center gap-3">
                                <div class="w-1.5 h-6 bg-blue-100 group-hover:bg-blue-500 transition-all rounded-full"></div>
                                <span class="uppercase tracking-tight text-gray-700 font-black">${row.status}</span>
                            </div>
                        </td>
                        <td class="px-6 py-5 text-center text-blue-600 text-sm">${row.l}</td>
                        <td class="px-6 py-5 text-center text-pink-600 text-sm">${row.p}</td>
                        <td class="px-10 py-5 text-center bg-gray-50/50 font-black text-gray-800 text-sm">${subTotal}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html || '<tr><td colspan="4" class="py-20 text-center text-gray-300 uppercase font-black">Database Kosong</td></tr>';
            
            // Update Footer Gelap
            document.getElementById('totalPegawaiL').innerText = tL;
            document.getElementById('totalPegawaiP').innerText = tP;
            document.getElementById('totalPegawaiSemua').innerText = (tL + tP);
            tfoot.classList.remove('hidden');

        } catch (e) {
            tbody.innerHTML = '<tr><td colspan="4" class="py-20 text-center text-red-400 uppercase font-black">Gagal memuat data pegawai</td></tr>';
        } finally {
            overlay.classList.add('hidden');
            icon.classList.remove('fa-spin');
        }
    }

    // Jalankan sinkronisasi saat halaman dimuat
    muatDataPegawai();
</script>
